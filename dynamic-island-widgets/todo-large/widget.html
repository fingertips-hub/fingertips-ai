<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÂæÖÂäû‰∫ãÈ°π</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        width: 100%;
        height: 100%;
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        overflow: hidden;
      }

      .todo-container {
        width: 100%;
        height: 100%;
        padding: 10px 12px;
        display: flex;
        flex-direction: column;
      }

      .todo-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        flex-shrink: 0;
      }

      .todo-header h3 {
        font-size: 15px;
        font-weight: 600;
        color: rgba(0, 0, 0, 0.85);
        letter-spacing: 0.3px;
      }

      .todo-stats {
        font-size: 11px;
        color: rgba(0, 0, 0, 0.5);
        font-weight: 500;
      }

      .todo-input-wrapper {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
        flex-shrink: 0;
      }

      .todo-input {
        flex: 1;
        padding: 6px 10px;
        border: 1.5px solid rgba(0, 0, 0, 0.1);
        border-radius: 6px;
        font-size: 12px;
        outline: none;
        transition: all 0.2s ease;
        background: rgba(255, 255, 255, 0.8);
        color: rgba(0, 0, 0, 0.85);
        line-height: 1.4;
      }

      .todo-input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        background: white;
      }

      .todo-input::placeholder {
        color: rgba(0, 0, 0, 0.35);
      }

      .todo-add-btn {
        width: 32px;
        height: 32px;
        min-width: 32px;
        padding: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 18px;
        font-weight: 400;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.25);
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
      }

      .todo-add-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.35);
      }

      .todo-add-btn:active {
        transform: translateY(0);
      }

      .todo-list {
        flex: 1;
        min-height: 0;
        max-height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        padding-right: 4px;
        position: relative;
      }

      .todo-list::-webkit-scrollbar {
        width: 4px;
      }

      .todo-list::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
        border-radius: 4px;
      }

      .todo-list::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.15);
        border-radius: 4px;
      }

      .todo-list::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.25);
      }

      .todo-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        margin-bottom: 4px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 6px;
        border: 1px solid rgba(0, 0, 0, 0.06);
        transition: all 0.2s ease;
        animation: slideIn 0.3s ease;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideOut {
        from {
          opacity: 1;
          transform: translateX(0) scale(1);
        }
        to {
          opacity: 0;
          transform: translateX(20px) scale(0.95);
        }
      }

      .todo-item:hover {
        background: white;
        border-color: rgba(0, 0, 0, 0.12);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      }

      .todo-checkbox {
        width: 18px;
        height: 18px;
        min-width: 18px;
        border: 2px solid rgba(0, 0, 0, 0.25);
        border-radius: 5px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        pointer-events: auto;
        position: relative;
        z-index: 10;
      }

      .todo-checkbox.checked {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-color: #667eea;
      }

      .todo-checkbox.checked::after {
        content: '‚úì';
        color: white;
        font-size: 12px;
        font-weight: bold;
      }

      .todo-text {
        flex: 1;
        font-size: 12px;
        color: rgba(0, 0, 0, 0.8);
        line-height: 1.4;
        word-break: break-word;
        transition: all 0.2s ease;
      }

      .todo-item.completed .todo-text {
        text-decoration: line-through;
        color: rgba(0, 0, 0, 0.4);
      }

      .todo-delete {
        width: 20px;
        height: 20px;
        min-width: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 5px;
        cursor: pointer;
        opacity: 0;
        transition: all 0.2s ease;
        color: rgba(0, 0, 0, 0.4);
        pointer-events: auto;
        position: relative;
        z-index: 10;
      }

      .todo-item:hover .todo-delete {
        opacity: 1;
      }

      .todo-delete:hover {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
      }

      .empty-state {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: rgba(0, 0, 0, 0.35);
        font-size: 12px;
        gap: 8px;
      }

      .empty-state-icon {
        font-size: 32px;
        opacity: 0.5;
      }
    </style>
  </head>
  <body>
    <div class="todo-container">
      <div class="todo-header">
        <h3>‰ªäÊó•ÂæÖÂäû</h3>
        <div class="todo-stats">
          <span id="completed-count">0</span> / <span id="total-count">0</span>
        </div>
      </div>

      <div class="todo-input-wrapper">
        <input
          type="text"
          class="todo-input"
          id="todo-input"
          placeholder="Ê∑ªÂä†Êñ∞ÁöÑÂæÖÂäû‰∫ãÈ°π..."
          maxlength="100"
        />
        <button class="todo-add-btn" id="add-btn" title="Ê∑ªÂä†">+</button>
      </div>

      <div class="todo-list" id="todo-list">
        <div class="empty-state" id="empty-state">
          <div class="empty-state-icon">üìù</div>
          <div>ÊöÇÊó†ÂæÖÂäû‰∫ãÈ°π</div>
        </div>
      </div>
    </div>

    <script>
      // Â≠òÂÇ®ÂæÖÂäû‰∫ãÈ°π
      let todos = []

      // ‰ªé localStorage Âä†ËΩΩÊï∞ÊçÆ
      function loadTodos() {
        try {
          const saved = localStorage.getItem('dynamic-island-todos')
          if (saved) {
            todos = JSON.parse(saved)
          }
        } catch (error) {
          console.error('Failed to load todos:', error)
        }
      }

      // ‰øùÂ≠òÂà∞ localStorage
      function saveTodos() {
        try {
          localStorage.setItem('dynamic-island-todos', JSON.stringify(todos))
        } catch (error) {
          console.error('Failed to save todos:', error)
        }
      }

      // Ê∏≤ÊüìÂæÖÂäûÂàóË°®
      function renderTodos(animate = true) {
        const todoList = document.getElementById('todo-list')
        let emptyState = document.getElementById('empty-state')

        // ÁßªÈô§ÊâÄÊúâÂæÖÂäûÈ°πÔºà‰ΩÜ‰øùÁïôÁ©∫Áä∂ÊÄÅÂÖÉÁ¥†Ôºâ
        const items = todoList.querySelectorAll('.todo-item')
        items.forEach((item) => item.remove())

        if (todos.length === 0) {
          // Â¶ÇÊûúÁ©∫Áä∂ÊÄÅÂÖÉÁ¥†‰∏çÂ≠òÂú®ÔºåÈáçÊñ∞ÂàõÂª∫
          if (!emptyState) {
            emptyState = document.createElement('div')
            emptyState.id = 'empty-state'
            emptyState.className = 'empty-state'
            emptyState.innerHTML = `
              <div class="empty-state-icon">üìù</div>
              <div>ÊöÇÊó†ÂæÖÂäû‰∫ãÈ°π</div>
            `
            todoList.appendChild(emptyState)
          }
          emptyState.style.display = 'flex'
          updateStats()
          return
        }

        // ÈöêËóèÁ©∫Áä∂ÊÄÅ
        if (emptyState) {
          emptyState.style.display = 'none'
        }

        // ÊåâÂÆåÊàêÁä∂ÊÄÅÊéíÂ∫èÔºöÊú™ÂÆåÊàêÁöÑÂú®ÂâçÔºåÂ∑≤ÂÆåÊàêÁöÑÂú®Âêé
        const sortedTodos = [...todos].sort((a, b) => {
          if (a.completed === b.completed) return 0
          return a.completed ? 1 : -1
        })

        // Ê∑ªÂä†ÊâÄÊúâÂæÖÂäûÈ°π
        sortedTodos.forEach((todo) => {
          // ÊâæÂà∞ÂéüÂßãÁ¥¢Âºï
          const index = todos.findIndex(
            (t) => t.createdAt === todo.createdAt && t.text === todo.text
          )
          const todoItem = document.createElement('div')
          todoItem.className = `todo-item ${todo.completed ? 'completed' : ''}`

          // Ê†πÊçÆÂèÇÊï∞ÂÜ≥ÂÆöÊòØÂê¶Ê∑ªÂä†Âä®Áîª
          if (!animate) {
            todoItem.style.animation = 'none'
          }

          const checkbox = document.createElement('div')
          checkbox.className = `todo-checkbox ${todo.completed ? 'checked' : ''}`
          checkbox.onclick = (e) => {
            console.log('checkbox Ë¢´ÁÇπÂáª', e)
            e.stopPropagation()
            toggleTodo(index)
          }

          const text = document.createElement('div')
          text.className = 'todo-text'
          text.textContent = todo.text

          const deleteBtn = document.createElement('div')
          deleteBtn.className = 'todo-delete'
          deleteBtn.innerHTML = '√ó'
          deleteBtn.onclick = (e) => {
            console.log('Âà†Èô§ÊåâÈíÆË¢´ÁÇπÂáª', e)
            e.stopPropagation()
            deleteTodo(index)
          }

          todoItem.appendChild(checkbox)
          todoItem.appendChild(text)
          todoItem.appendChild(deleteBtn)
          todoList.appendChild(todoItem)
        })

        updateStats()
      }

      // Êõ¥Êñ∞ÁªüËÆ°Êï∞ÊçÆ
      function updateStats() {
        const completedCount = todos.filter((t) => t.completed).length
        const totalCount = todos.length

        document.getElementById('completed-count').textContent = completedCount
        document.getElementById('total-count').textContent = totalCount
      }

      // Ê∑ªÂä†ÂæÖÂäû
      function addTodo() {
        console.log('addTodo Ë¢´Ë∞ÉÁî®')
        const input = document.getElementById('todo-input')
        const text = input.value.trim()

        console.log('ËæìÂÖ•ÂÜÖÂÆπ:', text)

        if (!text) {
          console.log('ËæìÂÖ•‰∏∫Á©∫ÔºåËøîÂõû')
          return
        }

        todos.unshift({
          text: text,
          completed: false,
          createdAt: Date.now()
        })

        input.value = ''
        saveTodos()
        renderTodos()
        console.log('ÂæÖÂäûÂ∑≤Ê∑ªÂä†ÔºåÂΩìÂâçÊÄªÊï∞:', todos.length)
      }

      // ÂàáÊç¢ÂÆåÊàêÁä∂ÊÄÅ
      function toggleTodo(index) {
        console.log('toggleTodo Ë¢´Ë∞ÉÁî®ÔºåÁ¥¢Âºï:', index)
        console.log('ÂΩìÂâçÁä∂ÊÄÅ:', todos[index].completed)
        todos[index].completed = !todos[index].completed
        console.log('Êñ∞Áä∂ÊÄÅ:', todos[index].completed)
        saveTodos()

        // ÈáçÊñ∞Ê∏≤Êüì‰ª•‰æøÈáçÊñ∞ÊéíÂ∫èÔºàÂ∑≤ÂÆåÊàêÁöÑÁßªÂà∞ÂêéÈù¢ÔºâÔºå‰∏çÊí≠ÊîæÂä®Áîª
        renderTodos(false)
        updateStats()
      }

      // Âà†Èô§ÂæÖÂäû
      function deleteTodo(index) {
        console.log('deleteTodo Ë¢´Ë∞ÉÁî®ÔºåÁ¥¢Âºï:', index)

        // Áõ¥Êé•Âà†Èô§Êï∞ÊçÆ
        todos.splice(index, 1)
        saveTodos()

        // ÈáçÊñ∞Ê∏≤ÊüìÔºå‰∏çÊí≠ÊîæÂä®Áîª
        renderTodos(false)
        updateStats()
      }

      // ÂàùÂßãÂåñ
      console.log('ÂàùÂßãÂåñÂæÖÂäû‰∫ãÈ°πÁªÑ‰ª∂')
      loadTodos()
      renderTodos()

      // ÁªëÂÆö‰∫ã‰ª∂
      const addBtn = document.getElementById('add-btn')
      const todoInput = document.getElementById('todo-input')

      console.log('Ê∑ªÂä†ÊåâÈíÆÂÖÉÁ¥†:', addBtn)
      console.log('ËæìÂÖ•Ê°ÜÂÖÉÁ¥†:', todoInput)

      if (addBtn) {
        addBtn.addEventListener('click', function (e) {
          console.log('ÊåâÈíÆË¢´ÁÇπÂáª', e)
          addTodo()
        })
        console.log('Ê∑ªÂä†ÊåâÈíÆ‰∫ã‰ª∂Â∑≤ÁªëÂÆö')
      } else {
        console.error('Êâæ‰∏çÂà∞Ê∑ªÂä†ÊåâÈíÆÂÖÉÁ¥†')
      }

      if (todoInput) {
        todoInput.addEventListener('keypress', (e) => {
          console.log('ÊåâÈîÆ‰∫ã‰ª∂:', e.key)
          if (e.key === 'Enter') {
            addTodo()
          }
        })
        console.log('ËæìÂÖ•Ê°ÜÂõûËΩ¶‰∫ã‰ª∂Â∑≤ÁªëÂÆö')
      } else {
        console.error('Êâæ‰∏çÂà∞ËæìÂÖ•Ê°ÜÂÖÉÁ¥†')
      }

      // ÊØèÂ§©Ê∏ÖÁêÜÂ∑≤ÂÆåÊàêÁöÑÊóß‰ªªÂä°ÔºàÂèØÈÄâÔºâ
      setInterval(
        () => {
          const oneDayAgo = Date.now() - 24 * 60 * 60 * 1000
          const oldCount = todos.length
          todos = todos.filter((todo) => !todo.completed || todo.createdAt > oneDayAgo)
          if (todos.length !== oldCount) {
            saveTodos()
            renderTodos()
          }
        },
        60 * 60 * 1000
      ) // ÊØèÂ∞èÊó∂Ê£ÄÊü•‰∏ÄÊ¨°
    </script>
  </body>
</html>
