<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>éšæ‰‹è®°</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        /* 2025 è‡ªç„¶é…è‰²ç³»ç»Ÿ */
        --primary-color: #6366f1;
        --primary-light: #818cf8;
        --primary-dark: #4f46e5;
        --accent-color: #ec4899;
        --success-color: #10b981;
        --danger-color: #ef4444;

        /* æ–‡å­—è‰²é˜¶ */
        --text-primary: #0f172a;
        --text-secondary: #475569;
        --text-tertiary: #94a3b8;
        --text-light: #cbd5e1;

        /* èƒŒæ™¯è‰²é˜¶ */
        --bg-primary: #ffffff;
        --bg-secondary: #f8fafc;
        --bg-tertiary: #f1f5f9;
        --bg-glass: rgba(255, 255, 255, 0.7);

        /* è¾¹æ¡† */
        --border-color: #e2e8f0;
        --border-subtle: #f1f5f9;

        /* é˜´å½±ç³»ç»Ÿï¼ˆæ›´è‡ªç„¶çš„å±‚æ¬¡ï¼‰*/
        --shadow-subtle: 0 1px 2px rgba(0, 0, 0, 0.04), 0 1px 3px rgba(0, 0, 0, 0.02);
        --shadow-soft: 0 2px 8px rgba(0, 0, 0, 0.04), 0 4px 16px rgba(0, 0, 0, 0.03);
        --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.06), 0 8px 24px rgba(0, 0, 0, 0.04);
        --shadow-large: 0 8px 32px rgba(0, 0, 0, 0.08), 0 12px 48px rgba(0, 0, 0, 0.06);

        /* åœ†è§’ç³»ç»Ÿï¼ˆä¸è§„åˆ™å˜åŒ–ï¼‰*/
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 20px;
        --radius-curved: 24px;
      }

      /* å™ªç‚¹è´¨æ„ŸèƒŒæ™¯ */
      @keyframes grain {
        0%,
        100% {
          transform: translate(0, 0);
        }
        10% {
          transform: translate(-5%, -10%);
        }
        20% {
          transform: translate(-15%, 5%);
        }
        30% {
          transform: translate(7%, -25%);
        }
        40% {
          transform: translate(-5%, 25%);
        }
        50% {
          transform: translate(-15%, 10%);
        }
        60% {
          transform: translate(15%, 0%);
        }
        70% {
          transform: translate(0%, 15%);
        }
        80% {
          transform: translate(3%, 35%);
        }
        90% {
          transform: translate(-10%, 10%);
        }
      }

      body {
        font-family:
          'SF Pro Display',
          -apple-system,
          BlinkMacSystemFont,
          'Segoe UI',
          'Inter',
          'Helvetica Neue',
          Arial,
          sans-serif;
        /* ä¼˜é›…çš„è“-ç²‰åŒè‰²æ¸å˜ - ä¿ç•™å“ç‰Œè‰²ä¸å±‚æ¬¡æ„Ÿ */
        background: linear-gradient(135deg, #eef2ff 0%, #fce7f3 100%);
        min-height: 100vh;
        padding: 24px;
        color: var(--text-primary);
        position: relative;
        overflow: hidden;
      }

      /* å™ªç‚¹çº¹ç†å±‚ */
      body::before {
        content: '';
        position: fixed;
        top: -50%;
        left: -50%;
        right: -50%;
        bottom: -50%;
        width: 200%;
        height: 200%;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
        opacity: 0.6;
        animation: grain 8s steps(10) infinite;
        pointer-events: none;
      }

      #app {
        max-width: 1280px;
        margin: 0 auto;
        /* æ¯›ç»ç’ƒæ•ˆæœ - Glassmorphism */
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(24px) saturate(180%);
        -webkit-backdrop-filter: blur(24px) saturate(180%);
        /* ä¸è§„åˆ™åœ†è§’ */
        border-radius: var(--radius-curved) var(--radius-curved) var(--radius-lg) var(--radius-lg);
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: var(--shadow-large);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        height: calc(100vh - 48px);
        position: relative;
      }

      /* æ·»åŠ å¾®å¦™çš„å†…å‘å…‰ */
      #app::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8) 50%, transparent);
      }

      /* å¤´éƒ¨ - å¤§æ ‡é¢˜è®¾è®¡ */
      .header {
        /* ç§»é™¤åˆºçœ¼çš„æ¸å˜ï¼Œä½¿ç”¨å¾®å¦™çš„èƒŒæ™¯ */
        background: linear-gradient(
          135deg,
          rgba(99, 102, 241, 0.03) 0%,
          rgba(236, 72, 153, 0.03) 100%
        );
        border-bottom: 1px solid var(--border-subtle);
        padding: 24px 32px 20px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        flex-shrink: 0;
      }

      .header-left {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .header h1 {
        font-size: 26px;
        font-weight: 800;
        margin: 0;
        color: var(--text-primary);
        letter-spacing: -0.02em;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      /* å“ç‰Œæ ‡è¯†åœ†ç‚¹ */
      .header h1::before {
        content: '';
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
        box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        flex-shrink: 0;
      }

      .header-badge {
        background: transparent;
        color: var(--text-tertiary);
        padding: 0;
        border-radius: 0;
        font-size: 10px;
        font-weight: 500;
        letter-spacing: 0.3px;
        text-transform: lowercase;
        border: none;
        width: fit-content;
        opacity: 0.5;
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 16px;
        padding-top: 4px;
      }

      .header-stats {
        text-align: center;
        background: white;
        padding: 10px 16px;
        border-radius: var(--radius-md);
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-subtle);
      }

      .header-stats .count {
        font-size: 24px;
        font-weight: 700;
        color: var(--primary-color);
        letter-spacing: -0.02em;
      }

      .header-stats .label {
        font-size: 11px;
        color: var(--text-tertiary);
        margin-top: 2px;
        letter-spacing: 0.3px;
      }

      /* å†…å®¹åŒºåŸŸ */
      .content {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      /* ä¾§è¾¹æ  - Bentoé£æ ¼ */
      .sidebar {
        width: 240px;
        background: var(--bg-secondary);
        border-right: 1px solid var(--border-subtle);
        display: flex;
        flex-direction: column;
      }

      .sidebar-header {
        padding: 18px 16px 16px;
        border-bottom: 1px solid var(--border-subtle);
      }

      .btn {
        width: 100%;
        padding: 11px 16px;
        border-radius: var(--radius-md);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        position: relative;
        overflow: hidden;
      }

      /* ç°ä»£æŸ”å’ŒæŒ‰é’®è®¾è®¡ */
      .btn-primary {
        background: white;
        color: var(--text-primary);
        border: 1.5px solid var(--border-color);
        box-shadow: var(--shadow-subtle);
      }

      .btn-primary::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          rgba(99, 102, 241, 0.04) 0%,
          rgba(236, 72, 153, 0.04) 100%
        );
        opacity: 0;
        transition: opacity 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .btn-primary:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
        transform: translateY(-1px);
        box-shadow:
          var(--shadow-soft),
          0 0 0 3px rgba(99, 102, 241, 0.08);
      }

      .btn-primary:hover::before {
        opacity: 1;
      }

      .btn-primary:active {
        transform: translateY(0);
        transition-duration: 0.1s;
        box-shadow: var(--shadow-subtle);
      }

      .btn-danger {
        background: var(--danger-color);
        color: white;
      }

      .btn-danger:hover {
        background: #dc2626;
      }

      .notes-list {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        padding: 14px 10px;
      }

      /* ç¬”è®°åˆ—è¡¨è¿‡æ¸¡åŠ¨ç”» */
      .note-list-enter-active {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .note-list-leave-active {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .note-list-enter-from {
        opacity: 0;
        transform: translateY(-12px) scale(0.95);
      }

      .note-list-leave-to {
        opacity: 0;
        transform: translateX(-12px) scale(0.95);
      }

      .note-list-move {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Bentoå¡ç‰‡è®¾è®¡ */
      .note-item {
        background: white;
        border: 1px solid var(--border-color);
        /* ä¸è§„åˆ™åœ†è§’ */
        border-radius: var(--radius-lg) var(--radius-md) var(--radius-lg) var(--radius-md);
        padding: 12px 14px;
        margin-bottom: 8px;
        cursor: pointer;
        /* ä¼˜åŒ–è¿‡æ¸¡ - åˆ†å¼€å®šä¹‰é¿å…æŠ–åŠ¨ */
        transition:
          background 0.25s cubic-bezier(0.4, 0, 0.2, 1),
          border-color 0.25s cubic-bezier(0.4, 0, 0.2, 1),
          box-shadow 0.25s cubic-bezier(0.4, 0, 0.2, 1),
          transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        /* ç¡®ä¿å¸ƒå±€ç¨³å®š */
        will-change: transform;
      }

      /* å¡ç‰‡çš„å¾®å¦™æ¸å˜èƒŒæ™¯ */
      .note-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, transparent 0%, rgba(99, 102, 241, 0.02) 100%);
        opacity: 0;
        transition: opacity 0.25s;
      }

      .note-item:hover::before {
        opacity: 1;
      }

      .note-item:hover {
        border-color: var(--primary-light);
        box-shadow: var(--shadow-soft);
        transform: translateX(4px);
      }

      .note-item.active {
        border-color: var(--primary-color);
        background: linear-gradient(
          135deg,
          rgba(99, 102, 241, 0.05) 0%,
          rgba(236, 72, 153, 0.03) 100%
        );
        box-shadow:
          var(--shadow-soft),
          0 0 0 1px rgba(99, 102, 241, 0.1) inset;
      }

      .note-item.active::before {
        opacity: 1;
      }

      .note-item-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
        position: relative;
        z-index: 1;
      }

      .note-item-title {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 13px;
        line-height: 1.4;
        letter-spacing: -0.01em;
        flex: 1;
        margin-right: 10px;
      }

      .note-item-time {
        font-size: 10px;
        color: var(--text-tertiary);
        font-weight: 500;
        letter-spacing: 0.3px;
        white-space: nowrap;
        background: var(--bg-tertiary);
        padding: 2px 6px;
        border-radius: 6px;
      }

      .note-item-preview {
        font-size: 12px;
        color: var(--text-secondary);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        line-height: 1.5;
        position: relative;
        z-index: 1;
      }

      .note-item-empty {
        color: var(--text-tertiary);
        font-style: italic;
      }

      /* ç¼–è¾‘å™¨åŒºåŸŸ */
      .editor-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: white;
        position: relative;
        min-height: 0; /* ç¡®ä¿ flex å­å…ƒç´ æ­£ç¡®æ”¶ç¼© */
      }

      /* ç¼–è¾‘å™¨åŒ…è£¹å±‚ - ç”¨äºè¿‡æ¸¡åŠ¨ç”» */
      .editor-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      /* Vueè¿‡æ¸¡åŠ¨ç”» - æ·¡å…¥æ·¡å‡º + è½»å¾®ä½ç§» */
      .editor-fade-enter-active,
      .editor-fade-leave-active {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .editor-fade-enter-from {
        opacity: 0;
        transform: translateY(8px);
      }

      .editor-fade-leave-to {
        opacity: 0;
        transform: translateY(-8px);
      }

      .editor-fade-enter-to,
      .editor-fade-leave-from {
        opacity: 1;
        transform: translateY(0);
      }

      .editor-header {
        padding: 20px 32px 16px;
        border-bottom: 1px solid var(--border-subtle);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0) 0%,
          rgba(99, 102, 241, 0.01) 100%
        );
      }

      .editor-title-input {
        flex: 1;
        border: none;
        font-size: 22px;
        font-weight: 700;
        color: var(--text-primary);
        outline: none;
        padding: 6px 0;
        letter-spacing: -0.02em;
        line-height: 1.3;
      }

      .editor-title-input::placeholder {
        color: var(--text-light);
      }

      .editor-actions {
        display: flex;
        gap: 10px;
        margin-left: 20px;
        align-items: center;
      }

      .btn-small {
        padding: 8px 14px;
        font-size: 13px;
        border-radius: var(--radius-md);
        border: none;
        cursor: pointer;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        white-space: nowrap;
      }

      .btn-outline {
        background: white;
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
        box-shadow: var(--shadow-subtle);
      }

      .btn-outline:hover {
        border-color: var(--danger-color);
        color: var(--danger-color);
        box-shadow: var(--shadow-soft);
        transform: translateY(-1px);
      }

      .btn-outline:active {
        transform: translateY(0);
      }

      /* ä¿å­˜çŠ¶æ€æŒ‡ç¤ºå™¨ */
      .save-indicator {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        color: var(--text-tertiary);
        padding: 6px 12px;
        border-radius: var(--radius-md);
        background: var(--bg-tertiary);
        border: 1px solid var(--border-subtle);
        font-weight: 500;
        letter-spacing: 0.3px;
        white-space: nowrap;
      }

      .save-indicator span:first-child {
        font-size: 8px;
        line-height: 1;
      }

      .save-indicator.pending {
        background: rgba(236, 72, 153, 0.05);
        color: var(--text-secondary);
        border-color: rgba(236, 72, 153, 0.1);
      }

      .save-indicator.pending span:first-child {
        color: var(--accent-color);
      }

      .save-indicator.saving {
        background: rgba(99, 102, 241, 0.05);
        color: var(--text-secondary);
        border-color: rgba(99, 102, 241, 0.1);
      }

      .save-indicator.saving span:first-child {
        color: var(--primary-color);
        animation: pulse 1.5s ease-in-out infinite;
      }

      .save-indicator.saved {
        background: rgba(16, 185, 129, 0.05);
        color: var(--text-secondary);
        border-color: rgba(16, 185, 129, 0.1);
      }

      .save-indicator.saved span:first-child {
        color: var(--success-color);
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      .editor-content {
        flex: 1;
        padding: 40px;
        overflow-y: auto;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0) 0%,
          rgba(99, 102, 241, 0.005) 100%
        );
      }

      .editor-textarea {
        width: 100%;
        height: 100%;
        border: none;
        outline: none;
        resize: none;
        font-size: 16px;
        line-height: 1.75;
        color: var(--text-primary);
        font-family:
          'SF Pro Text',
          -apple-system,
          BlinkMacSystemFont,
          'Segoe UI',
          sans-serif;
        letter-spacing: -0.01em;
      }

      .editor-textarea::placeholder {
        color: var(--text-light);
      }

      /* ç©ºçŠ¶æ€ */
      .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        padding: 60px 40px;
        text-align: center;
      }

      .empty-state-icon {
        width: 80px;
        height: 80px;
        margin-bottom: 24px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* å‡ ä½•å›¾å½¢ - ä¼˜é›…çš„åœ†å½¢è½®å»“ */
      .empty-state-icon::before {
        content: '';
        width: 100%;
        height: 100%;
        border: 3px solid var(--border-color);
        border-radius: 50%;
        position: absolute;
      }

      .empty-state-icon::after {
        content: '';
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
        border-radius: 50%;
        opacity: 0.1;
      }

      .empty-state-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text-secondary);
        letter-spacing: -0.01em;
      }

      .empty-state-text {
        font-size: 14px;
        color: var(--text-tertiary);
        line-height: 1.6;
        max-width: 300px;
      }

      /* ä¼˜é›…çš„æ»šåŠ¨æ¡ */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--text-light);
        border-radius: var(--radius-sm);
        transition: background 0.2s;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--text-tertiary);
      }

      /* åŠ¨ç”»ç³»ç»Ÿ */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-12px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .fade-in {
        animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .slide-in {
        animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* é€‰æ‹©æ–‡æœ¬çš„æ ·å¼ */
      ::selection {
        background: rgba(99, 102, 241, 0.15);
        color: var(--text-primary);
      }

      /* å“åº”å¼ */
      @media (max-width: 1024px) {
        #app {
          max-width: 100%;
        }

        .sidebar {
          width: 220px;
        }

        .note-item {
          padding: 10px 12px;
        }

        .header {
          padding: 20px 28px 18px;
        }

        .header h1 {
          font-size: 24px;
          gap: 8px;
        }

        .header h1::before {
          width: 9px;
          height: 9px;
        }

        .header-stats {
          padding: 8px 14px;
        }

        .header-stats .count {
          font-size: 22px;
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 16px;
        }

        #app {
          border-radius: var(--radius-lg);
        }

        .header {
          padding: 18px 24px 16px;
        }

        .header h1 {
          font-size: 22px;
          gap: 8px;
        }

        .header h1::before {
          width: 8px;
          height: 8px;
        }

        .header-stats {
          padding: 8px 12px;
        }

        .header-stats .count {
          font-size: 20px;
        }

        .sidebar {
          width: 200px;
        }

        .sidebar-header {
          padding: 16px 14px 14px;
        }

        .btn {
          padding: 10px 14px;
          font-size: 13px;
        }

        .btn-primary {
          border-width: 1px;
        }

        .notes-list {
          padding: 12px 8px;
        }

        .note-item {
          padding: 10px 12px;
          margin-bottom: 7px;
        }

        .note-item-title {
          font-size: 12px;
        }

        .note-item-preview {
          font-size: 11px;
        }

        .editor-content {
          padding: 28px 24px;
        }

        .editor-header {
          padding: 16px 24px 14px;
        }

        .editor-title-input {
          font-size: 20px;
        }

        .editor-actions {
          margin-left: 16px;
          gap: 8px;
        }

        .btn-small {
          padding: 7px 12px;
          font-size: 12px;
        }

        .save-indicator {
          padding: 5px 10px;
          font-size: 11px;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <!-- å¤´éƒ¨ -->
      <div class="header">
        <div class="header-left">
          <h1>{{ pluginName }}</h1>
          <span class="header-badge">v{{ version }}</span>
        </div>
        <div class="header-right">
          <div class="header-stats">
            <div class="count">{{ notes.length }}</div>
            <div class="label">æ¡ç¬”è®°</div>
          </div>
        </div>
      </div>

      <!-- å†…å®¹åŒºåŸŸ -->
      <div class="content">
        <!-- ä¾§è¾¹æ  - ç¬”è®°åˆ—è¡¨ -->
        <div class="sidebar">
          <div class="sidebar-header">
            <button class="btn btn-primary" @click="createNote">
              <span style="font-size: 16px; font-weight: 400">+</span>
              <span>æ–°å»ºç¬”è®°</span>
            </button>
          </div>

          <div class="notes-list">
            <!-- ä½¿ç”¨ TransitionGroup ä¸ºåˆ—è¡¨é¡¹æ·»åŠ è¿‡æ¸¡åŠ¨ç”» -->
            <transition-group name="note-list">
              <div
                v-for="note in sortedNotes"
                :key="note.id"
                :class="['note-item', { active: currentNote && currentNote.id === note.id }]"
                @click="selectNote(note)"
              >
                <div class="note-item-header">
                  <div class="note-item-title">{{ note.title || 'æ— æ ‡é¢˜' }}</div>
                  <div class="note-item-time">{{ formatTime(note.updatedAt) }}</div>
                </div>
                <div :class="['note-item-preview', { 'note-item-empty': !note.content }]">
                  {{ note.content || 'ç©ºç¬”è®°' }}
                </div>
              </div>
            </transition-group>

            <!-- ç©ºçŠ¶æ€ -->
            <div v-if="notes.length === 0" class="empty-state">
              <div class="empty-state-icon"></div>
              <div class="empty-state-title">æš‚æ— ç¬”è®°</div>
              <div class="empty-state-text">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»ºç¬¬ä¸€æ¡ç¬”è®°</div>
            </div>
          </div>
        </div>

        <!-- ç¼–è¾‘å™¨ -->
        <div class="editor-container">
          <!-- ä½¿ç”¨ Transition åŒ…è£¹,mode="out-in" ç¡®ä¿æ—§å†…å®¹ç¦»å¼€åæ–°å†…å®¹æ‰è¿›å…¥ -->
          <transition name="editor-fade" mode="out-in">
            <!-- ç¼–è¾‘å™¨å†…å®¹ - ä½¿ç”¨ key ç¡®ä¿ç¬”è®°åˆ‡æ¢æ—¶è§¦å‘è¿‡æ¸¡ -->
            <div v-if="currentNote" :key="currentNote.id" class="editor-wrapper">
              <div class="editor-header">
                <input
                  v-model="currentNote.title"
                  class="editor-title-input"
                  placeholder="ç¬”è®°æ ‡é¢˜..."
                  @input="onContentChange"
                />
                <div class="editor-actions">
                  <div :class="['save-indicator', saveStatus]">
                    <span v-if="saveStatus === 'saving'">â—</span>
                    <span v-else-if="saveStatus === 'saved'">â—</span>
                    <span v-else>â—</span>
                    <span v-if="saveStatus === 'saving'">ä¿å­˜ä¸­</span>
                    <span v-else-if="saveStatus === 'saved'">å·²ä¿å­˜</span>
                    <span v-else>å¾…ä¿å­˜</span>
                  </div>
                  <button class="btn-small btn-outline" @click="deleteCurrentNote">
                    <span style="font-size: 14px; font-weight: 400">Ã—</span>
                    <span>åˆ é™¤</span>
                  </button>
                </div>
              </div>

              <div class="editor-content">
                <textarea
                  v-model="currentNote.content"
                  class="editor-textarea"
                  placeholder="å¼€å§‹å†™ç‚¹ä»€ä¹ˆå§..."
                  @input="onContentChange"
                  @blur="saveNotes"
                ></textarea>
              </div>
            </div>

            <!-- æœªé€‰æ‹©ç¬”è®°çš„ç©ºçŠ¶æ€ -->
            <div v-else key="empty" class="empty-state">
              <div class="empty-state-icon"></div>
              <div class="empty-state-title">é€‰æ‹©æˆ–åˆ›å»ºä¸€æ¡ç¬”è®°</div>
              <div class="empty-state-text">åœ¨å·¦ä¾§é€‰æ‹©ä¸€æ¡ç¬”è®°å¼€å§‹ç¼–è¾‘,æˆ–åˆ›å»ºä¸€æ¡æ–°ç¬”è®°</div>
            </div>
          </transition>
        </div>
      </div>
    </div>

    <!-- å¼•å…¥ Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script>
      const { createApp, ref, reactive, computed, watch, onMounted, onUnmounted } = Vue

      createApp({
        setup() {
          // çŠ¶æ€
          const pluginId = ref('')
          const pluginName = ref('éšæ‰‹è®°')
          const version = ref('1.0.0')
          const notes = ref([])
          const currentNote = ref(null)
          const saveStatus = ref('saved') // 'saved' | 'saving' | 'pending'
          let saveTimer = null
          let isSaving = false // é˜²æ­¢å¹¶å‘ä¿å­˜
          let isSwitching = false // é˜²æ­¢å¿«é€Ÿåˆ‡æ¢ç¬”è®°å¯¼è‡´æŠ–åŠ¨

          // è®¡ç®—å±æ€§ - æŒ‰æ›´æ–°æ—¶é—´æ’åºçš„ç¬”è®°
          const sortedNotes = computed(() => {
            return [...notes.value].sort((a, b) => b.updatedAt - a.updatedAt)
          })

          // ç”Ÿå‘½å‘¨æœŸ
          onMounted(async () => {
            // è·å–æ’ä»¶ä¿¡æ¯
            if (window.pluginData) {
              pluginId.value = window.pluginData.pluginId
              pluginName.value = window.pluginData.pluginName || 'éšæ‰‹è®°'
              version.value = window.pluginData.version || '1.0.0'
            }

            // åŠ è½½ç¬”è®°
            await loadNotes()

            // å¦‚æœæœ‰ç¬”è®°,é€‰æ‹©ç¬¬ä¸€æ¡
            if (notes.value.length > 0) {
              currentNote.value = notes.value[0]
            } else {
              // æ²¡æœ‰ç¬”è®°,åˆ›å»ºä¸€æ¡
              createNote()
            }

            // ç›‘å¬çª—å£å…³é—­å‰äº‹ä»¶
            window.addEventListener('beforeunload', handleBeforeUnload)

            console.log('âœ… éšæ‰‹è®°å·²åŠ è½½,å…±', notes.value.length, 'æ¡ç¬”è®°')
          })

          onUnmounted(() => {
            // æ¸…ç†
            if (saveTimer) {
              clearTimeout(saveTimer)
            }
            window.removeEventListener('beforeunload', handleBeforeUnload)

            // ç¡®ä¿æœ€åä¿å­˜ä¸€æ¬¡
            saveNotes()
          })

          // æ–¹æ³•

          /**
           * ä»ä¸»è¿›ç¨‹åŠ è½½ç¬”è®°
           */
          async function loadNotes() {
            try {
              if (!window.api || !window.api.plugin) {
                console.error('âŒ IPC API ä¸å¯ç”¨')
                notes.value = []
                return
              }

              const result = await window.api.plugin.invoke(`${pluginId.value}:getNotes`)

              if (result.success) {
                notes.value = result.data || []
                console.log('ğŸ“– åŠ è½½ç¬”è®°:', notes.value.length, 'æ¡')
              } else {
                console.error('åŠ è½½ç¬”è®°å¤±è´¥:', result.error)
                notes.value = []
              }
            } catch (error) {
              console.error('åŠ è½½ç¬”è®°å¤±è´¥:', error)
              notes.value = []
            }
          }

          /**
           * ä¿å­˜ç¬”è®°åˆ°ä¸»è¿›ç¨‹
           */
          async function saveNotes() {
            // é˜²æ­¢å¹¶å‘ä¿å­˜
            if (isSaving) {
              console.log('â³ æ­£åœ¨ä¿å­˜,è·³è¿‡æœ¬æ¬¡ä¿å­˜')
              return
            }

            try {
              isSaving = true
              saveStatus.value = 'saving'

              if (!window.api || !window.api.plugin) {
                console.error('âŒ IPC API ä¸å¯ç”¨')
                saveStatus.value = 'saved'
                return
              }

              // æ·±æ‹·è´ç¬”è®°æ•°æ®,ç¡®ä¿æ•°æ®å®Œæ•´æ€§
              const notesToSave = JSON.parse(JSON.stringify(notes.value))

              const result = await window.api.plugin.invoke(
                `${pluginId.value}:saveNotes`,
                notesToSave
              )

              if (result.success) {
                saveStatus.value = 'saved'
                console.log('ğŸ’¾ ç¬”è®°å·²ä¿å­˜:', notes.value.length, 'æ¡')
              } else {
                console.error('ä¿å­˜ç¬”è®°å¤±è´¥:', result.error)
                saveStatus.value = 'saved'

                // æ˜¾ç¤ºé”™è¯¯æç¤º
                alert('ä¿å­˜å¤±è´¥: ' + result.error)
              }
            } catch (error) {
              console.error('ä¿å­˜ç¬”è®°å¤±è´¥:', error)
              saveStatus.value = 'saved'

              // æ˜¾ç¤ºé”™è¯¯æç¤º
              alert('ä¿å­˜å¤±è´¥: ' + error.message)
            } finally {
              isSaving = false
            }
          }

          /**
           * åˆ›å»ºæ–°ç¬”è®°
           */
          function createNote() {
            // é˜²æ­¢å¿«é€Ÿè¿ç»­åˆ›å»º
            if (isSwitching) {
              console.log('â³ æ­£åœ¨åˆ‡æ¢ç¬”è®°,è¯·ç¨å€™...')
              return
            }

            isSwitching = true

            const newNote = {
              id: generateId(),
              title: '',
              content: '',
              createdAt: Date.now(),
              updatedAt: Date.now()
            }

            notes.value.unshift(newNote)

            // ä½¿ç”¨ requestAnimationFrame ç¡®ä¿å¹³æ»‘åˆ‡æ¢
            requestAnimationFrame(() => {
              currentNote.value = newNote

              // ç«‹å³ä¿å­˜
              saveNotes()

              console.log('â• åˆ›å»ºæ–°ç¬”è®°:', newNote.id)

              // è¿‡æ¸¡åŠ¨ç”»å®Œæˆåè§£é™¤é”å®š
              setTimeout(() => {
                isSwitching = false
              }, 350)
            })
          }

          /**
           * é€‰æ‹©ç¬”è®°
           */
          function selectNote(note) {
            // é˜²æ­¢å¿«é€Ÿåˆ‡æ¢å¯¼è‡´æŠ–åŠ¨
            if (isSwitching) {
              console.log('â³ æ­£åœ¨åˆ‡æ¢ç¬”è®°,è¯·ç¨å€™...')
              return
            }

            // å¦‚æœæ˜¯åŒä¸€æ¡ç¬”è®°,ç›´æ¥è¿”å›
            if (currentNote.value && currentNote.value.id === note.id) {
              return
            }

            isSwitching = true

            // å…ˆä¿å­˜å½“å‰ç¬”è®°
            if (currentNote.value) {
              saveNotes()
            }

            // ä½¿ç”¨ requestAnimationFrame ç¡®ä¿å¹³æ»‘åˆ‡æ¢
            requestAnimationFrame(() => {
              currentNote.value = note
              console.log('ğŸ“ é€‰æ‹©ç¬”è®°:', note.id)

              // è¿‡æ¸¡åŠ¨ç”»å®Œæˆåè§£é™¤é”å®š(300ms æ˜¯è¿‡æ¸¡æ—¶é—´)
              setTimeout(() => {
                isSwitching = false
              }, 350)
            })
          }

          /**
           * åˆ é™¤å½“å‰ç¬”è®°
           */
          function deleteCurrentNote() {
            if (!currentNote.value) return

            if (notes.value.length === 1) {
              // æœ€åä¸€æ¡ç¬”è®°,æ¸…ç©ºå†…å®¹è€Œä¸æ˜¯åˆ é™¤
              currentNote.value.title = ''
              currentNote.value.content = ''
              currentNote.value.updatedAt = Date.now()
              saveNotes()
              return
            }

            const index = notes.value.findIndex((n) => n.id === currentNote.value.id)
            if (index !== -1) {
              notes.value.splice(index, 1)

              // é€‰æ‹©ä¸‹ä¸€æ¡ç¬”è®°
              if (notes.value.length > 0) {
                currentNote.value = notes.value[0]
              } else {
                currentNote.value = null
              }

              saveNotes()
              console.log('ğŸ—‘ï¸ åˆ é™¤ç¬”è®°')
            }
          }

          /**
           * å†…å®¹å˜åŒ–æ—¶è§¦å‘(é˜²æŠ–ä¿å­˜)
           */
          function onContentChange() {
            saveStatus.value = 'pending'

            if (currentNote.value) {
              currentNote.value.updatedAt = Date.now()
            }

            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (saveTimer) {
              clearTimeout(saveTimer)
            }

            // 300ms åè‡ªåŠ¨ä¿å­˜
            saveTimer = setTimeout(() => {
              saveNotes()
            }, 300)
          }

          /**
           * çª—å£å…³é—­å‰ä¿å­˜
           */
          function handleBeforeUnload(event) {
            saveNotes()
          }

          /**
           * ç”Ÿæˆå”¯ä¸€ ID
           */
          function generateId() {
            return `note_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
          }

          /**
           * æ ¼å¼åŒ–æ—¶é—´
           */
          function formatTime(timestamp) {
            const now = Date.now()
            const diff = now - timestamp

            // 1åˆ†é’Ÿå†…
            if (diff < 60 * 1000) {
              return 'åˆšåˆš'
            }

            // 1å°æ—¶å†…
            if (diff < 60 * 60 * 1000) {
              const minutes = Math.floor(diff / (60 * 1000))
              return `${minutes}åˆ†é’Ÿå‰`
            }

            // ä»Šå¤©
            const date = new Date(timestamp)
            const today = new Date()
            if (date.toDateString() === today.toDateString()) {
              return date.toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit'
              })
            }

            // æ˜¨å¤©
            const yesterday = new Date(today)
            yesterday.setDate(yesterday.getDate() - 1)
            if (date.toDateString() === yesterday.toDateString()) {
              return (
                'æ˜¨å¤© ' +
                date.toLocaleTimeString('zh-CN', {
                  hour: '2-digit',
                  minute: '2-digit'
                })
              )
            }

            // å…¶ä»–æ—¥æœŸ
            return date.toLocaleDateString('zh-CN', {
              month: '2-digit',
              day: '2-digit',
              hour: '2-digit',
              minute: '2-digit'
            })
          }

          // è¿”å›
          return {
            pluginName,
            version,
            notes,
            currentNote,
            sortedNotes,
            saveStatus,
            createNote,
            selectNote,
            deleteCurrentNote,
            onContentChange,
            saveNotes,
            formatTime
          }
        }
      }).mount('#app')
    </script>
  </body>
</html>
