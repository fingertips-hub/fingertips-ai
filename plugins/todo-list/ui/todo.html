<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        /* ç°ä»£é…è‰²æ–¹æ¡ˆ - æŸ”å’Œä¸“ä¸š */
        --color-primary: #6366f1;
        --color-primary-light: #818cf8;
        --color-primary-dark: #4f46e5;
        --color-bg: #fafbfc;
        --color-surface: #ffffff;
        --color-surface-hover: #f8f9fa;
        --color-border: #e5e7eb;
        --color-border-light: #f3f4f6;
        --color-text: #1f2937;
        --color-text-secondary: #6b7280;
        --color-text-muted: #9ca3af;

        /* ä¼˜å…ˆçº§é¢œè‰² - æŸ”å’Œç‰ˆæœ¬ */
        --color-priority-high: #ef4444;
        --color-priority-high-light: #fee2e2;
        --color-priority-medium: #f59e0b;
        --color-priority-medium-light: #fef3c7;
        --color-priority-low: #10b981;
        --color-priority-low-light: #d1fae5;

        /* é˜´å½± */
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

        /* é—´è·ç³»ç»Ÿ */
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.25rem;
        --space-6: 1.5rem;
        --space-8: 2rem;

        /* åœ†è§’ */
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell',
          'Helvetica Neue', Arial, sans-serif;
        background: var(--color-bg);
        min-height: 100vh;
        padding: var(--space-6);
        overflow-x: hidden;
        color: var(--color-text);
        line-height: 1.6;
      }

      #app {
        max-width: 900px;
        margin: 0 auto;
      }

      /* å¤´éƒ¨åŒºåŸŸ - ç´§å‡‘ä¼˜åŒ– */
      .header {
        background: var(--color-surface);
        border-radius: var(--radius-xl);
        padding: var(--space-5) var(--space-6);
        margin-bottom: var(--space-4);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--color-border-light);
      }

      .header-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-5);
      }

      .header-title {
        display: flex;
        align-items: center;
        gap: var(--space-3);
      }

      .header-icon {
        width: 36px;
        height: 36px;
        background: linear-gradient(
          135deg,
          var(--color-primary) 0%,
          var(--color-primary-dark) 100%
        );
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        box-shadow: var(--shadow-sm);
      }

      h1 {
        font-size: 24px;
        font-weight: 700;
        color: var(--color-text);
        letter-spacing: -0.02em;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: var(--space-4);
        padding: var(--space-4) 0 0 0;
        border-top: 1px solid var(--color-border-light);
      }

      .stat-item {
        text-align: center;
        position: relative;
      }

      .stat-item:not(:last-child)::after {
        content: '';
        position: absolute;
        right: calc(var(--space-4) / -2);
        top: 50%;
        transform: translateY(-50%);
        width: 1px;
        height: 24px;
        background: var(--color-border-light);
      }

      .stat-value {
        font-size: 24px;
        font-weight: 700;
        color: var(--color-primary);
        margin-bottom: var(--space-1);
        line-height: 1;
        letter-spacing: -0.03em;
      }

      .stat-label {
        font-size: 12px;
        color: var(--color-text-secondary);
        font-weight: 500;
        letter-spacing: 0.02em;
      }

      /* è¿‡æ»¤å™¨å’Œæ“ä½œæ  - æç®€è®¾è®¡ */
      .filters {
        background: var(--color-surface);
        border-radius: var(--radius-xl);
        padding: var(--space-3) var(--space-4);
        margin-bottom: var(--space-4);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--color-border-light);
        display: flex;
        gap: var(--space-4);
        flex-wrap: wrap;
        align-items: center;
      }

      .filter-group {
        display: flex;
        gap: var(--space-2);
        background: var(--color-bg);
        padding: var(--space-1);
        border-radius: var(--radius-lg);
      }

      .filter-btn {
        padding: var(--space-2) var(--space-4);
        border: none;
        background: transparent;
        border-radius: var(--radius-md);
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        color: var(--color-text-secondary);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .filter-btn.active {
        background: var(--color-primary);
        color: white;
        box-shadow: var(--shadow-sm);
      }

      .filter-btn:hover:not(.active) {
        background: var(--color-surface-hover);
        color: var(--color-text);
      }

      /* æœç´¢æ¡†å’Œæ·»åŠ æŒ‰é’®ç»„åˆ */
      .search-and-add {
        flex: 1;
        display: flex;
        gap: var(--space-3);
        align-items: center;
        min-width: 300px;
      }

      .search-box {
        flex: 1;
        min-width: 180px;
        position: relative;
      }

      .search-input {
        width: 100%;
        padding: var(--space-3) var(--space-4) var(--space-3) 36px;
        border: 1px solid var(--color-border);
        background: var(--color-bg);
        border-radius: var(--radius-lg);
        font-size: 14px;
        color: var(--color-text);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .search-input::placeholder {
        color: var(--color-text-muted);
      }

      .search-input:focus {
        outline: none;
        border-color: var(--color-primary);
        background: var(--color-surface);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }

      .search-icon {
        position: absolute;
        left: var(--space-3);
        top: 50%;
        transform: translateY(-50%);
        color: var(--color-text-muted);
        font-size: 16px;
      }

      /* æ·»åŠ ä»»åŠ¡æŒ‰é’® - ç°ä»£ç®€çº¦ */
      .add-todo-btn {
        padding: var(--space-3) var(--space-5);
        background: var(--color-surface);
        color: var(--color-primary);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
        box-shadow: var(--shadow-sm);
        white-space: nowrap;
        flex-shrink: 0;
      }

      .add-todo-btn:hover {
        background: var(--color-primary);
        color: white;
        border-color: var(--color-primary);
        box-shadow: var(--shadow-md);
        transform: translateY(-1px);
      }

      .add-todo-btn:active {
        transform: translateY(0);
      }

      .add-icon {
        font-size: 16px;
      }

      /* Dialog å¼¹çª—æ ·å¼ */
      .add-dialog {
        border: none;
        border-radius: var(--radius-xl);
        padding: 0;
        max-width: 500px;
        width: 90%;
        box-shadow: var(--shadow-xl);
        background: transparent;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        margin: 0;
      }

      .add-dialog::backdrop {
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
      }

      .dialog-content {
        background: var(--color-surface);
        border-radius: var(--radius-xl);
        overflow: hidden;
      }

      .dialog-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-6);
        border-bottom: 1px solid var(--color-border-light);
      }

      .dialog-title {
        font-size: 20px;
        font-weight: 700;
        color: var(--color-text);
        margin: 0;
      }

      .dialog-close {
        width: 32px;
        height: 32px;
        border: none;
        background: var(--color-bg);
        color: var(--color-text-secondary);
        border-radius: var(--radius-md);
        cursor: pointer;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .dialog-close:hover {
        background: var(--color-priority-high);
        color: white;
      }

      .dialog-body {
        padding: var(--space-6);
      }

      .form-group {
        margin-bottom: var(--space-5);
      }

      .form-group:last-child {
        margin-bottom: 0;
      }

      .form-label {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        font-size: 14px;
        font-weight: 600;
        color: var(--color-text);
        margin-bottom: var(--space-3);
      }

      .label-icon {
        font-size: 14px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--space-4);
      }

      .form-input {
        width: 100%;
        padding: var(--space-3) var(--space-4);
        border: 1px solid var(--color-border);
        background: var(--color-bg);
        border-radius: var(--radius-lg);
        font-size: 15px;
        color: var(--color-text);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 400;
      }

      .form-input::placeholder {
        color: var(--color-text-muted);
      }

      .form-input:focus {
        outline: none;
        border-color: var(--color-primary);
        background: var(--color-surface);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }

      .form-date {
        cursor: pointer;
      }

      .form-textarea {
        width: 100%;
        padding: var(--space-3) var(--space-4);
        border: 1px solid var(--color-border);
        background: var(--color-bg);
        border-radius: var(--radius-lg);
        font-size: 14px;
        color: var(--color-text);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        font-family: inherit;
        resize: vertical;
        min-height: 80px;
        line-height: 1.6;
      }

      .form-textarea::placeholder {
        color: var(--color-text-muted);
      }

      .form-textarea:focus {
        outline: none;
        border-color: var(--color-primary);
        background: var(--color-surface);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }

      .priority-selector {
        display: flex;
        gap: var(--space-2);
      }

      .priority-btn {
        flex: 1;
        padding: var(--space-2) var(--space-3);
        border: 1px solid var(--color-border);
        background: var(--color-surface);
        border-radius: var(--radius-md);
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
      }

      .priority-btn:hover:not(.active) {
        background: var(--color-surface-hover);
        border-color: var(--color-text-muted);
      }

      /* é«˜ä¼˜å…ˆçº§æŒ‰é’® */
      .priority-btn.high {
        color: var(--color-priority-high);
      }

      .priority-btn.high.active {
        background: var(--color-priority-high);
        border-color: var(--color-priority-high);
        color: white;
        box-shadow: var(--shadow-sm);
      }

      /* ä¸­ä¼˜å…ˆçº§æŒ‰é’® */
      .priority-btn.medium {
        color: var(--color-priority-medium);
      }

      .priority-btn.medium.active {
        background: var(--color-priority-medium);
        border-color: var(--color-priority-medium);
        color: white;
        box-shadow: var(--shadow-sm);
      }

      /* ä½ä¼˜å…ˆçº§æŒ‰é’® */
      .priority-btn.low {
        color: var(--color-priority-low);
      }

      .priority-btn.low.active {
        background: var(--color-priority-low);
        border-color: var(--color-priority-low);
        color: white;
        box-shadow: var(--shadow-sm);
      }

      .dialog-footer {
        display: flex;
        justify-content: flex-end;
        gap: var(--space-3);
        padding: var(--space-5) var(--space-6);
        border-top: 1px solid var(--color-border-light);
        background: var(--color-bg);
      }

      .dialog-btn {
        padding: var(--space-3) var(--space-5);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .dialog-btn-cancel {
        background: var(--color-surface);
        color: var(--color-text-secondary);
      }

      .dialog-btn-cancel:hover {
        background: var(--color-surface-hover);
        border-color: var(--color-border);
      }

      .dialog-btn-primary {
        background: var(--color-primary);
        color: white;
        border-color: var(--color-primary);
        box-shadow: var(--shadow-sm);
      }

      .dialog-btn-primary:hover:not(:disabled) {
        background: var(--color-primary-dark);
        box-shadow: var(--shadow-md);
      }

      .dialog-btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* å¾…åŠåˆ—è¡¨ - ç²¾è‡´å¡ç‰‡ */
      .todo-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
      }

      .todo-item {
        background: var(--color-surface);
        border-radius: var(--radius-lg);
        padding: var(--space-4) var(--space-5);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--color-border-light);
        display: flex;
        align-items: center;
        gap: var(--space-4);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .todo-item:hover {
        box-shadow: var(--shadow-md);
        border-color: var(--color-border);
      }

      .todo-item.completed {
        opacity: 0.6;
        background: var(--color-bg);
      }

      /* ç°ä»£åŒ– Checkbox */
      .todo-checkbox {
        width: 22px;
        height: 22px;
        border: 2px solid var(--color-border);
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--color-surface);
        position: relative;
      }

      .todo-checkbox:hover {
        border-color: var(--color-primary);
        background: rgba(99, 102, 241, 0.05);
        transform: scale(1.1);
      }

      .todo-checkbox.checked {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        border-color: #6366f1;
        animation: checkBounce 0.3s ease;
      }

      @keyframes checkBounce {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
      }

      .todo-checkbox.checked::after {
        content: '';
        position: absolute;
        width: 5px;
        height: 10px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
        animation: checkMark 0.3s ease 0.1s both;
      }

      @keyframes checkMark {
        0% {
          height: 0;
          width: 0;
          opacity: 0;
        }
        20% {
          height: 0;
          width: 5px;
          opacity: 1;
        }
        40% {
          height: 10px;
          width: 5px;
          opacity: 1;
        }
        100% {
          height: 10px;
          width: 5px;
          opacity: 1;
        }
      }

      .priority-indicator {
        width: 3px;
        height: 32px;
        border-radius: 99px;
        flex-shrink: 0;
      }

      .priority-indicator.high {
        background: var(--color-priority-high);
      }

      .priority-indicator.medium {
        background: var(--color-priority-medium);
      }

      .priority-indicator.low {
        background: var(--color-priority-low);
      }

      .todo-content {
        flex: 1;
        min-width: 0;
      }

      .todo-text {
        font-size: 15px;
        color: var(--color-text);
        margin-bottom: var(--space-2);
        word-break: break-word;
        line-height: 1.6;
        font-weight: 400;
      }

      .todo-item.completed .todo-text {
        text-decoration: line-through;
        color: var(--color-text-muted);
      }

      /* å¤‡æ³¨ - ç´§å‡‘å•è¡Œè®¾è®¡ */
      .todo-notes {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        margin-bottom: var(--space-2);
        padding: var(--space-2) var(--space-3);
        background: var(--color-bg);
        border-radius: var(--radius-md);
        font-size: 13px;
        color: var(--color-text-secondary);
        line-height: 1.5;
        border-left: 2px solid var(--color-border);
      }

      .notes-icon {
        font-size: 14px;
        flex-shrink: 0;
        opacity: 0.7;
      }

      .notes-text {
        flex: 1;
        font-style: italic;
      }

      .todo-item.completed .todo-notes {
        opacity: 0.5;
      }

      /* å…ƒä¿¡æ¯è¡Œ - æ‰€æœ‰æ ‡ç­¾åœ¨ä¸€è¡Œ */
      .todo-meta {
        font-size: 12px;
        color: var(--color-text-secondary);
        display: flex;
        align-items: center;
        gap: var(--space-3);
        flex-wrap: wrap;
      }

      /* æˆªæ­¢æ—¥æœŸæ ‡ç­¾ - ç´§å‡‘inlineè®¾è®¡ */
      .due-date-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 2px 8px;
        border-radius: var(--radius-md);
        font-size: 12px;
        font-weight: 500;
        transition: all 0.2s;
      }

      .badge-icon {
        font-size: 11px;
      }

      /* é»˜è®¤çŠ¶æ€ - ç°è‰² */
      .due-date-badge {
        background: var(--color-bg);
        color: var(--color-text-secondary);
        border: 1px solid var(--color-border-light);
      }

      /* å·²è¿‡æœŸ - çº¢è‰² */
      .due-date-badge.overdue {
        background: rgba(239, 68, 68, 0.08);
        border-color: rgba(239, 68, 68, 0.2);
        color: #dc2626;
      }

      /* ä»Šå¤©åˆ°æœŸ - æ©™è‰² */
      .due-date-badge.today {
        background: rgba(251, 191, 36, 0.08);
        border-color: rgba(251, 191, 36, 0.2);
        color: #f59e0b;
      }

      /* å³å°†åˆ°æœŸ - è“è‰² */
      .due-date-badge.upcoming {
        background: rgba(99, 102, 241, 0.08);
        border-color: rgba(99, 102, 241, 0.2);
        color: var(--color-primary);
      }

      .create-time {
        color: var(--color-text-muted);
        font-size: 11px;
      }

      /* ä¼˜å…ˆçº§æ ‡ç­¾ - ç°ä»£åŒ–è®¾è®¡ */
      .priority-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 3px 10px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .priority-badge::before {
        content: '';
        width: 6px;
        height: 6px;
        border-radius: 50%;
        flex-shrink: 0;
      }

      .priority-badge.high {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
      }

      .priority-badge.high::before {
        background: #dc2626;
        box-shadow: 0 0 4px rgba(239, 68, 68, 0.4);
      }

      .priority-badge.medium {
        background: rgba(99, 102, 241, 0.1);
        color: #6366f1;
      }

      .priority-badge.medium::before {
        background: #6366f1;
        box-shadow: 0 0 4px rgba(99, 102, 241, 0.4);
      }

      .priority-badge.low {
        background: rgba(156, 163, 175, 0.1);
        color: #6b7280;
      }

      .priority-badge.low::before {
        background: #9ca3af;
      }

      .todo-actions {
        display: flex;
        gap: var(--space-2);
        opacity: 0;
        transition: opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .todo-item:hover .todo-actions {
        opacity: 1;
      }

      /* ç°ä»£å›¾æ ‡æŒ‰é’® */
      .action-btn {
        width: 32px;
        height: 32px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: none;
        background: transparent;
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        color: var(--color-text-secondary);
        position: relative;
      }

      .action-btn:hover {
        background: var(--color-bg);
        transform: scale(1.1);
      }

      .action-btn.edit:hover {
        background: rgba(99, 102, 241, 0.1);
        color: var(--color-primary);
      }

      .action-btn.delete:hover {
        background: rgba(239, 68, 68, 0.1);
        color: var(--color-danger);
      }

      /* SVG å›¾æ ‡æ ·å¼ */
      .action-btn svg {
        width: 16px;
        height: 16px;
        stroke-width: 2;
      }

      /* Tooltip */
      .action-btn::before {
        content: attr(aria-label);
        position: absolute;
        top: -30px;
        left: 50%;
        transform: translateX(-50%) scale(0);
        padding: 4px 8px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        font-size: 11px;
        border-radius: 4px;
        white-space: nowrap;
        pointer-events: none;
        opacity: 0;
        transition: all 0.2s;
      }

      .action-btn:hover::before {
        transform: translateX(-50%) scale(1);
        opacity: 1;
      }

      /* ç©ºçŠ¶æ€ - ä¼˜é›…è®¾è®¡ */
      .empty-state {
        text-align: center;
        padding: var(--space-8) var(--space-6);
        background: var(--color-surface);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--color-border-light);
      }

      .empty-icon {
        font-size: 72px;
        margin-bottom: var(--space-4);
        opacity: 0.6;
        filter: grayscale(0.2);
      }

      .empty-text {
        font-size: 18px;
        color: var(--color-text);
        margin-bottom: var(--space-2);
        font-weight: 600;
      }

      .empty-hint {
        font-size: 14px;
        color: var(--color-text-secondary);
      }

      /* åº•éƒ¨æ“ä½œæ  - ç®€æ´å¸ƒå±€ */
      .footer {
        background: var(--color-surface);
        border-radius: var(--radius-xl);
        padding: var(--space-4) var(--space-5);
        margin-top: var(--space-4);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--color-border-light);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .footer-info {
        font-size: 14px;
        color: var(--color-text-secondary);
        font-weight: 500;
      }

      .footer-actions {
        display: flex;
        gap: var(--space-3);
      }

      .footer-btn {
        padding: var(--space-3) var(--space-5);
        border: 1px solid var(--color-border);
        background: var(--color-surface);
        border-radius: var(--radius-lg);
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        color: var(--color-priority-high);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .footer-btn:hover:not(:disabled) {
        background: var(--color-priority-high);
        border-color: var(--color-priority-high);
        color: white;
        box-shadow: var(--shadow-sm);
      }

      .footer-btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }

      /* ç¼–è¾‘æ¨¡å¼ - æ¸…æ™°åé¦ˆ */
      .edit-input {
        width: 100%;
        padding: var(--space-2) var(--space-4);
        border: 2px solid var(--color-primary);
        background: var(--color-surface);
        border-radius: var(--radius-md);
        font-size: 15px;
        font-family: inherit;
        color: var(--color-text);
      }

      .edit-input:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }

      /* åŠ è½½çŠ¶æ€ - ä¼˜é›…åŠ¨ç”» */
      .loading {
        text-align: center;
        padding: var(--space-8);
        color: var(--color-text-secondary);
        font-size: 16px;
        font-weight: 500;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 768px) {
        body {
          padding: var(--space-4);
        }

        .header {
          padding: var(--space-4) var(--space-5);
        }

        h1 {
          font-size: 20px;
        }

        .header-icon {
          width: 32px;
          height: 32px;
          font-size: 18px;
        }

        .stats {
          grid-template-columns: repeat(2, 1fr);
          gap: var(--space-3);
        }

        .stat-item:nth-child(2n)::after {
          display: none;
        }

        .stat-value {
          font-size: 20px;
        }

        .filters {
          flex-direction: column;
        }

        .filter-group {
          width: 100%;
        }

        .search-and-add {
          width: 100%;
          min-width: 0;
          flex-direction: column;
        }

        .search-box {
          width: 100%;
        }

        .add-todo-btn {
          width: 100%;
        }

        .todo-item {
          padding: var(--space-3) var(--space-4);
        }

        /* Dialog ç§»åŠ¨ç«¯ä¼˜åŒ– */
        .add-dialog {
          max-width: 95%;
          width: 95%;
        }

        .dialog-header,
        .dialog-body,
        .dialog-footer {
          padding: var(--space-4);
        }

        .dialog-title {
          font-size: 18px;
        }

        .priority-selector {
          flex-direction: column;
        }

        .dialog-footer {
          flex-direction: column-reverse;
        }

        .dialog-btn {
          width: 100%;
        }
      }

      /* æ»šåŠ¨æ¡æ ·å¼ - ç²¾è‡´ */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--color-bg);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--color-border);
        border-radius: 99px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--color-text-muted);
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div v-if="loading" class="loading">åŠ è½½ä¸­...</div>

      <template v-else>
        <!-- å¤´éƒ¨ -->
        <div class="header">
          <div class="header-top">
            <div class="header-title">
              <div class="header-icon">âœ“</div>
              <h1>{{ pluginName }}</h1>
            </div>
          </div>

          <!-- ç»Ÿè®¡ -->
          <div class="stats">
            <div class="stat-item">
              <div class="stat-value">{{ totalCount }}</div>
              <div class="stat-label">æ€»ä»»åŠ¡</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{ activeCount }}</div>
              <div class="stat-label">è¿›è¡Œä¸­</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{ completedCount }}</div>
              <div class="stat-label">å·²å®Œæˆ</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{ completionRate }}%</div>
              <div class="stat-label">å®Œæˆç‡</div>
            </div>
          </div>
        </div>

        <!-- è¿‡æ»¤å™¨å’Œæ“ä½œæ  -->
        <div class="filters">
          <div class="filter-group">
            <button
              v-for="filter in filters"
              :key="filter.value"
              :class="['filter-btn', { active: currentFilter === filter.value }]"
              @click="currentFilter = filter.value"
            >
              {{ filter.label }}
            </button>
          </div>

          <div class="search-and-add">
            <div class="search-box">
              <span class="search-icon">ğŸ”</span>
              <input
                type="text"
                class="search-input"
                v-model="searchQuery"
                placeholder="æœç´¢ä»»åŠ¡..."
              />
            </div>

            <button class="add-todo-btn" @click="openAddDialog">
              <span class="add-icon">â•</span>
              <span>æ·»åŠ ä»»åŠ¡</span>
            </button>
          </div>
        </div>

        <!-- ä»»åŠ¡Dialogï¼ˆæ·»åŠ /ç¼–è¾‘é€šç”¨ï¼‰ -->
        <dialog ref="todoDialog" class="add-dialog" @click="handleDialogClick">
          <div class="dialog-content">
            <div class="dialog-header">
              <h2 class="dialog-title">{{ dialogMode === 'add' ? 'æ·»åŠ æ–°ä»»åŠ¡' : 'ç¼–è¾‘ä»»åŠ¡' }}</h2>
              <button class="dialog-close" @click="closeTodoDialog" aria-label="å…³é—­">âœ•</button>
            </div>

            <div class="dialog-body">
              <div class="form-group">
                <label class="form-label">ä»»åŠ¡å†…å®¹ *</label>
                <input
                  type="text"
                  class="form-input"
                  v-model="todoText"
                  @keyup.enter="saveTodoFromDialog"
                  placeholder="è¯·è¾“å…¥ä»»åŠ¡å†…å®¹..."
                  ref="dialogInput"
                />
              </div>

              <div class="form-group">
                <label class="form-label">ä¼˜å…ˆçº§</label>
                <div class="priority-selector">
                  <button
                    v-for="p in priorities"
                    :key="p.value"
                    :class="['priority-btn', p.value, { active: todoPriority === p.value }]"
                    @click="todoPriority = p.value"
                  >
                    <span>{{ p.icon }}</span>
                    <span>{{ p.label }}</span>
                  </button>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">
                    <span class="label-icon">ğŸ“…</span>
                    <span>æˆªæ­¢æ—¥æœŸ</span>
                  </label>
                  <input
                    type="date"
                    class="form-input form-date"
                    v-model="todoDueDate"
                    :min="getTodayDate()"
                  />
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">
                  <span class="label-icon">ğŸ“</span>
                  <span>å¤‡æ³¨</span>
                </label>
                <textarea
                  class="form-textarea"
                  v-model="todoNotes"
                  placeholder="æ·»åŠ å¤‡æ³¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰..."
                  rows="3"
                ></textarea>
              </div>
            </div>

            <div class="dialog-footer">
              <button class="dialog-btn dialog-btn-cancel" @click="closeTodoDialog">å–æ¶ˆ</button>
              <button
                class="dialog-btn dialog-btn-primary"
                @click="saveTodoFromDialog"
                :disabled="!todoText.trim()"
              >
                {{ dialogMode === 'add' ? 'æ·»åŠ ä»»åŠ¡' : 'ä¿å­˜ä¿®æ”¹' }}
              </button>
            </div>
          </div>
        </dialog>

        <!-- å¾…åŠåˆ—è¡¨ -->
        <div class="todo-list" v-if="filteredTodos.length > 0">
          <div
            v-for="todo in filteredTodos"
            :key="todo.id"
            :class="['todo-item', { completed: todo.completed }]"
          >
            <div
              :class="['todo-checkbox', { checked: todo.completed }]"
              @click="toggleTodo(todo.id)"
            ></div>

            <div :class="['priority-indicator', todo.priority]"></div>

            <div class="todo-content">
              <div class="todo-text">{{ todo.text }}</div>

              <!-- å¤‡æ³¨ï¼ˆå¦‚æœæœ‰ï¼‰-->
              <div class="todo-notes" v-if="todo.notes">
                <span class="notes-icon">ğŸ’¬</span>
                <span class="notes-text">{{ todo.notes }}</span>
              </div>

              <!-- å…ƒä¿¡æ¯è¡Œï¼šä¼˜å…ˆçº§ + æˆªæ­¢æ—¥æœŸ + åˆ›å»ºæ—¶é—´ -->
              <div class="todo-meta">
                <span :class="['priority-badge', todo.priority]"
                  >{{ getPriorityLabel(todo.priority) }}</span
                >
                <span
                  v-if="todo.dueDate"
                  :class="['due-date-badge', getDueDateClass(todo.dueDate, todo.completed)]"
                >
                  <span class="badge-icon">ğŸ“…</span>
                  <span>{{ formatDueDate(todo.dueDate) }}</span>
                </span>
                <span class="create-time">{{ formatDate(todo.createdAt) }}</span>
              </div>
            </div>

            <div class="todo-actions">
              <button class="action-btn edit" @click="openEditDialog(todo)" aria-label="ç¼–è¾‘ä»»åŠ¡">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"
                  />
                </svg>
              </button>
              <button class="action-btn delete" @click="deleteTodo(todo.id)" aria-label="åˆ é™¤ä»»åŠ¡">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"
                  />
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- ç©ºçŠ¶æ€ -->
        <div class="empty-state" v-else>
          <div class="empty-icon">ğŸ“</div>
          <div class="empty-text">{{ emptyMessage }}</div>
          <div class="empty-hint">æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å¼€å§‹å§ï¼</div>
        </div>

        <!-- åº•éƒ¨ -->
        <div class="footer" v-if="totalCount > 0">
          <div class="footer-info">{{ filteredTodos.length }} ä¸ªä»»åŠ¡</div>
          <div class="footer-actions">
            <button class="footer-btn" @click="clearCompleted" v-if="completedCount > 0">
              ğŸ—‘ï¸ æ¸…ç©ºå·²å®Œæˆ ({{ completedCount }})
            </button>
          </div>
        </div>
      </template>
    </div>

    <!-- å¼•å…¥ Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script>
      const { createApp, ref, computed, reactive, onMounted, nextTick, watch } = Vue

      createApp({
        setup() {
          // çŠ¶æ€
          const pluginId = ref('')
          const pluginName = ref('Todo List')
          const loading = ref(true)
          const todos = ref([])
          const currentFilter = ref('all')
          const searchQuery = ref('')

          // DialogçŠ¶æ€ï¼ˆæ·»åŠ /ç¼–è¾‘é€šç”¨ï¼‰
          const dialogMode = ref('add') // 'add' æˆ– 'edit'
          const editingTodoId = ref(null)
          const todoText = ref('')
          const todoPriority = ref('medium')
          const todoDueDate = ref('')
          const todoNotes = ref('')
          const todoDialog = ref(null)
          const dialogInput = ref(null)

          let saveTimer = null
          let isSaving = false // é˜²æ­¢å¹¶å‘ä¿å­˜

          // è¿‡æ»¤å™¨é€‰é¡¹
          const filters = [
            { value: 'all', label: 'å…¨éƒ¨' },
            { value: 'active', label: 'è¿›è¡Œä¸­' },
            { value: 'completed', label: 'å·²å®Œæˆ' }
          ]

          // ä¼˜å…ˆçº§é€‰é¡¹
          const priorities = [
            { value: 'high', label: 'é«˜ä¼˜å…ˆçº§', icon: 'âš¡' },
            { value: 'medium', label: 'ä¸­ä¼˜å…ˆçº§', icon: 'â—' },
            { value: 'low', label: 'ä½ä¼˜å…ˆçº§', icon: 'â—‹' }
          ]

          // è®¡ç®—å±æ€§
          const totalCount = computed(() => todos.value.length)

          const activeCount = computed(() => todos.value.filter((t) => !t.completed).length)

          const completedCount = computed(() => todos.value.filter((t) => t.completed).length)

          const completionRate = computed(() => {
            if (totalCount.value === 0) return 0
            return Math.round((completedCount.value / totalCount.value) * 100)
          })

          const filteredTodos = computed(() => {
            let result = todos.value

            // æŒ‰çŠ¶æ€è¿‡æ»¤
            if (currentFilter.value === 'active') {
              result = result.filter((t) => !t.completed)
            } else if (currentFilter.value === 'completed') {
              result = result.filter((t) => t.completed)
            }

            // æœç´¢è¿‡æ»¤
            if (searchQuery.value.trim()) {
              const query = searchQuery.value.toLowerCase()
              result = result.filter((t) => t.text.toLowerCase().includes(query))
            }

            return result
          })

          const emptyMessage = computed(() => {
            if (searchQuery.value.trim()) {
              return 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ä»»åŠ¡'
            }
            if (currentFilter.value === 'active') {
              return 'æ²¡æœ‰è¿›è¡Œä¸­çš„ä»»åŠ¡'
            }
            if (currentFilter.value === 'completed') {
              return 'è¿˜æ²¡æœ‰å®Œæˆçš„ä»»åŠ¡'
            }
            return 'è¿˜æ²¡æœ‰ä»»åŠ¡'
          })

          // ç”Ÿå‘½å‘¨æœŸ
          onMounted(async () => {
            await loadData()

            // æ•°æ®åŠ è½½å®Œæˆåï¼Œè®¾ç½® watch ç›‘å¬åç»­å˜åŒ–ï¼ˆé˜²æŠ–ä¿å­˜ï¼‰
            watch(
              todos,
              () => {
                // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
                if (saveTimer) {
                  clearTimeout(saveTimer)
                }

                // 300ms åè‡ªåŠ¨ä¿å­˜
                saveTimer = setTimeout(() => {
                  saveTodos()
                }, 300)
              },
              { deep: true }
            )

            // ç›‘å¬çª—å£å…³é—­å‰äº‹ä»¶
            window.addEventListener('beforeunload', handleBeforeUnload)

            console.log('âœ… Todo List å·²åŠ è½½')
          })

          // æ–¹æ³•
          async function loadData() {
            loading.value = true
            try {
              console.log('ğŸ”„ å¼€å§‹åŠ è½½æ•°æ®...')

              // è·å–æ’ä»¶ä¿¡æ¯
              if (window.pluginData) {
                pluginId.value = window.pluginData.pluginId
                pluginName.value = window.pluginData.pluginName || 'Todo List'
              }

              // ä»ä¸»è¿›ç¨‹åŠ è½½ä»»åŠ¡
              if (!window.api || !window.api.plugin) {
                console.error('âŒ IPC API ä¸å¯ç”¨')
                todos.value = []
                return
              }

              const result = await window.api.plugin.invoke(`${pluginId.value}:getTodos`)

              if (result.success) {
                todos.value = result.data || []
                console.log(`âœ… ä»ä¸»è¿›ç¨‹åŠ è½½äº† ${todos.value.length} ä¸ªä»»åŠ¡`)
                if (todos.value.length > 0) {
                  console.log('ä»»åŠ¡åˆ—è¡¨:', todos.value.map((t) => t.text).join(', '))
                }
              } else {
                console.error('âŒ åŠ è½½ä»»åŠ¡å¤±è´¥:', result.error)
                todos.value = []
              }
            } catch (error) {
              console.error('âŒ åŠ è½½æ•°æ®å¤±è´¥:', error)
              todos.value = []
            } finally {
              loading.value = false
              console.log('âœ… æ•°æ®åŠ è½½å®Œæˆ')
            }
          }

          /**
           * ä¿å­˜ä»»åŠ¡åˆ°ä¸»è¿›ç¨‹
           */
          async function saveTodos() {
            // é˜²æ­¢å¹¶å‘ä¿å­˜
            if (isSaving) {
              console.log('â³ æ­£åœ¨ä¿å­˜ï¼Œè·³è¿‡æœ¬æ¬¡ä¿å­˜')
              return
            }

            try {
              isSaving = true

              if (!window.api || !window.api.plugin) {
                console.error('âŒ IPC API ä¸å¯ç”¨')
                return
              }

              // æ·±æ‹·è´ä»»åŠ¡æ•°æ®ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§
              const todosToSave = JSON.parse(JSON.stringify(todos.value))

              const result = await window.api.plugin.invoke(
                `${pluginId.value}:saveTodos`,
                todosToSave
              )

              if (result.success) {
                console.log(`ğŸ’¾ ä»»åŠ¡å·²ä¿å­˜: ${todos.value.length} æ¡`)
              } else {
                console.error('âŒ ä¿å­˜ä»»åŠ¡å¤±è´¥:', result.error)
                alert('ä¿å­˜å¤±è´¥: ' + result.error)
              }
            } catch (error) {
              console.error('âŒ ä¿å­˜ä»»åŠ¡å¤±è´¥:', error)
              alert('ä¿å­˜å¤±è´¥: ' + error.message)
            } finally {
              isSaving = false
            }
          }

          /**
           * çª—å£å…³é—­å‰ä¿å­˜
           */
          function handleBeforeUnload(event) {
            saveTodos()
          }

          async function toggleTodo(todoId) {
            try {
              const todo = todos.value.find((t) => t.id === todoId)
              if (!todo) return

              // åˆ‡æ¢çŠ¶æ€
              todo.completed = !todo.completed
              todo.updatedAt = new Date().toISOString()

              // å‘é€é€šçŸ¥
              if (window.api && window.api.plugin) {
                try {
                  await window.api.plugin.invoke('todo-list:notifyTaskToggled', {
                    text: todo.text,
                    completed: todo.completed
                  })
                } catch (notifyError) {
                  console.warn('å‘é€é€šçŸ¥å¤±è´¥:', notifyError)
                }
              }
            } catch (error) {
              console.error('åˆ‡æ¢ä»»åŠ¡çŠ¶æ€å¤±è´¥:', error)
            }
          }

          async function deleteTodo(todoId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) return

            try {
              // ç›´æ¥ä»åˆ—è¡¨ä¸­åˆ é™¤ï¼ˆä¼šè‡ªåŠ¨è§¦å‘ watch ä¿å­˜ï¼‰
              todos.value = todos.value.filter((t) => t.id !== todoId)
            } catch (error) {
              console.error('åˆ é™¤ä»»åŠ¡å¤±è´¥:', error)
            }
          }

          async function clearCompleted() {
            const count = completedCount.value
            if (!confirm(`ç¡®å®šè¦æ¸…ç©º ${count} ä¸ªå·²å®Œæˆçš„ä»»åŠ¡å—ï¼Ÿ`)) return

            try {
              // è¿‡æ»¤æ‰å·²å®Œæˆçš„ä»»åŠ¡ï¼ˆä¼šè‡ªåŠ¨è§¦å‘ watch ä¿å­˜ï¼‰
              todos.value = todos.value.filter((t) => !t.completed)

              // å‘é€é€šçŸ¥
              if (window.api && window.api.plugin) {
                try {
                  await window.api.plugin.invoke('todo-list:notifyCleared', count)
                } catch (notifyError) {
                  console.warn('å‘é€é€šçŸ¥å¤±è´¥:', notifyError)
                }
              }
            } catch (error) {
              console.error('æ¸…ç©ºå·²å®Œæˆä»»åŠ¡å¤±è´¥:', error)
            }
          }

          /**
           * æ‰“å¼€æ·»åŠ ä»»åŠ¡Dialog
           */
          function openAddDialog() {
            dialogMode.value = 'add'
            editingTodoId.value = null
            todoText.value = ''
            todoPriority.value = 'medium'
            todoDueDate.value = ''
            todoNotes.value = ''

            if (todoDialog.value) {
              todoDialog.value.showModal()
              nextTick(() => {
                if (dialogInput.value) {
                  dialogInput.value.focus()
                }
              })
            }
          }

          /**
           * æ‰“å¼€ç¼–è¾‘ä»»åŠ¡Dialog
           */
          function openEditDialog(todo) {
            dialogMode.value = 'edit'
            editingTodoId.value = todo.id
            todoText.value = todo.text
            todoPriority.value = todo.priority
            todoDueDate.value = todo.dueDate || ''
            todoNotes.value = todo.notes || ''

            if (todoDialog.value) {
              todoDialog.value.showModal()
              nextTick(() => {
                if (dialogInput.value) {
                  dialogInput.value.focus()
                }
              })
            }
          }

          /**
           * å…³é—­Dialog
           */
          function closeTodoDialog() {
            if (todoDialog.value) {
              todoDialog.value.close()
            }
            // æ¸…ç©ºæ•°æ®
            editingTodoId.value = null
            todoText.value = ''
            todoPriority.value = 'medium'
            todoDueDate.value = ''
            todoNotes.value = ''
          }

          /**
           * å¤„ç†Dialogç‚¹å‡»äº‹ä»¶ï¼ˆç‚¹å‡»å¤–éƒ¨å…³é—­ï¼‰
           */
          function handleDialogClick(event) {
            if (event.target === todoDialog.value) {
              closeTodoDialog()
            }
          }

          /**
           * ä»Dialogä¿å­˜ä»»åŠ¡ï¼ˆæ·»åŠ æˆ–ç¼–è¾‘ï¼‰
           */
          async function saveTodoFromDialog() {
            const text = todoText.value.trim()
            if (!text) return

            try {
              if (dialogMode.value === 'add') {
                // æ·»åŠ æ–°ä»»åŠ¡
                const newTodo = {
                  id: Date.now().toString(),
                  text: text,
                  completed: false,
                  priority: todoPriority.value,
                  dueDate: todoDueDate.value || null,
                  notes: todoNotes.value.trim() || null,
                  createdAt: new Date().toISOString(),
                  updatedAt: new Date().toISOString()
                }

                todos.value.push(newTodo)
                console.log(`â• æ·»åŠ ä»»åŠ¡: ${text}`)

                // å‘é€é€šçŸ¥
                if (window.api && window.api.plugin) {
                  try {
                    await window.api.plugin.invoke('todo-list:notifyTaskAdded', {
                      text: newTodo.text
                    })
                  } catch (notifyError) {
                    console.warn('âš ï¸  å‘é€é€šçŸ¥å¤±è´¥:', notifyError)
                  }
                }
              } else {
                // ç¼–è¾‘ç°æœ‰ä»»åŠ¡
                const todo = todos.value.find((t) => t.id === editingTodoId.value)
                if (!todo) return

                todo.text = text
                todo.priority = todoPriority.value
                todo.dueDate = todoDueDate.value || null
                todo.notes = todoNotes.value.trim() || null
                todo.updatedAt = new Date().toISOString()

                console.log(`ğŸ“ ç¼–è¾‘ä»»åŠ¡: ${text}`)
              }

              // å…³é—­Dialog
              closeTodoDialog()
            } catch (error) {
              console.error('âŒ ä¿å­˜ä»»åŠ¡å¤±è´¥:', error)
              alert('ä¿å­˜ä»»åŠ¡å¤±è´¥: ' + error.message)
            }
          }

          function getPriorityLabel(priority) {
            const p = priorities.find((p) => p.value === priority)
            return p ? p.label : ''
          }

          function formatDate(dateString) {
            const date = new Date(dateString)
            const now = new Date()
            const diff = now - date

            // å°äº1åˆ†é’Ÿ
            if (diff < 60000) {
              return 'åˆšåˆš'
            }

            // å°äº1å°æ—¶
            if (diff < 3600000) {
              const minutes = Math.floor(diff / 60000)
              return `${minutes} åˆ†é’Ÿå‰`
            }

            // å°äº1å¤©
            if (diff < 86400000) {
              const hours = Math.floor(diff / 3600000)
              return `${hours} å°æ—¶å‰`
            }

            // å°äº7å¤©
            if (diff < 604800000) {
              const days = Math.floor(diff / 86400000)
              return `${days} å¤©å‰`
            }

            // æ ¼å¼åŒ–æ—¥æœŸ
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`
          }

          /**
           * è·å–ä»Šå¤©çš„æ—¥æœŸï¼ˆYYYY-MM-DD æ ¼å¼ï¼‰
           */
          function getTodayDate() {
            const today = new Date()
            return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`
          }

          /**
           * æ ¼å¼åŒ–æˆªæ­¢æ—¥æœŸ
           */
          function formatDueDate(dateString) {
            if (!dateString) return ''

            const dueDate = new Date(dateString)
            const today = new Date()
            today.setHours(0, 0, 0, 0)
            dueDate.setHours(0, 0, 0, 0)

            const diffTime = dueDate.getTime() - today.getTime()
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24))

            if (diffDays < 0) {
              return `å·²è¿‡æœŸ ${Math.abs(diffDays)} å¤©`
            } else if (diffDays === 0) {
              return 'ä»Šå¤©åˆ°æœŸ'
            } else if (diffDays === 1) {
              return 'æ˜å¤©åˆ°æœŸ'
            } else if (diffDays <= 7) {
              return `${diffDays} å¤©ååˆ°æœŸ`
            } else {
              const month = dueDate.getMonth() + 1
              const day = dueDate.getDate()
              return `${month}æœˆ${day}æ—¥åˆ°æœŸ`
            }
          }

          /**
           * è·å–æˆªæ­¢æ—¥æœŸçš„CSSç±»å
           */
          function getDueDateClass(dateString, isCompleted) {
            if (!dateString || isCompleted) return ''

            const dueDate = new Date(dateString)
            const today = new Date()
            today.setHours(0, 0, 0, 0)
            dueDate.setHours(0, 0, 0, 0)

            const diffTime = dueDate.getTime() - today.getTime()
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24))

            if (diffDays < 0) {
              return 'overdue' // å·²è¿‡æœŸ
            } else if (diffDays === 0) {
              return 'today' // ä»Šå¤©
            } else if (diffDays <= 3) {
              return 'upcoming' // å³å°†åˆ°æœŸ
            }
            return ''
          }

          return {
            pluginName,
            loading,
            todos,
            currentFilter,
            searchQuery,
            dialogMode,
            editingTodoId,
            todoText,
            todoPriority,
            todoDueDate,
            todoNotes,
            todoDialog,
            dialogInput,
            filters,
            priorities,
            totalCount,
            activeCount,
            completedCount,
            completionRate,
            filteredTodos,
            emptyMessage,
            toggleTodo,
            deleteTodo,
            clearCompleted,
            openAddDialog,
            openEditDialog,
            closeTodoDialog,
            handleDialogClick,
            saveTodoFromDialog,
            getPriorityLabel,
            formatDate,
            getTodayDate,
            formatDueDate,
            getDueDateClass
          }
        }
      }).mount('#app')
    </script>
  </body>
</html>
